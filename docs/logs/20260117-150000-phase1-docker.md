# 実装ログ: 2026-01-17

## セッション情報
- **日時**: 2026-01-17
- **フェーズ**: Phase 1.1（Docker環境のセットアップ）
- **目標**: OllamaとSearXNGのDocker環境を構築し、モデルをダウンロードする

---

## 作業内容

### 完了したタスク
- [x] 実装計画の作成 (`docs/plans/20260117-phase1.1-docker-setup.md`)
- [x] SearXNG設定ファイルの作成 (`searxng/settings.yml`)
- [x] Docker Compose設定ファイルの作成 (`docker-compose.yaml`)
- [x] Dockerサービスの起動と動作確認
- [x] Ollamaモデルのダウンロード (deepseek-r1:7b, qwen2.5:3b)
- [x] 変更のコミットとプッシュ

### 実装したファイル
- `docker-compose.yaml`: Ollama + SearXNG のDocker構成
  - Ollama: GPU対応、Flash Attention有効、24時間モデル常駐
  - SearXNG: JSON API有効、メモリ1GB制限
- `searxng/settings.yml`: SearXNG設定
  - JSON API有効化
  - レート制限無効化（ローカル自動化用）
  - 研究向けエンジン選定（Google, Bing, Wikipedia, arXiv等）
- `docs/plans/20260117-phase1.1-docker-setup.md`: Phase 1.1実装計画

---

## TDD記録

### Docker環境はTDD困難なため手動検証

検証チェックリスト:
- [x] NVIDIA Container Toolkitインストール済み
- [x] Ollamaコンテナ起動、GPU認識 (GTX 1660 SUPER 6144 MiB)
- [x] Ollama API応答 (`curl http://localhost:11434/api/tags`)
- [x] `OLLAMA_FLASH_ATTENTION=1` 設定済み
- [x] `OLLAMA_KEEP_ALIVE=24h` 設定済み
- [x] SearXNGコンテナ起動
- [x] ヘルスチェック応答 (`/healthz`)
- [x] JSON API動作 (`format=json` で結果取得)
- [x] deepseek-r1:7b ダウンロード済み (4.7 GB)
- [x] qwen2.5:3b ダウンロード済み (1.9 GB)

---

## 問題と解決策

### 問題1: 1Passwordの認証エラー
**状況**: `git commit` 時に `1Password: failed to fill whole buffer` エラー発生
**原因**: GPG署名に1Password認証が必要
**解決策**: ユーザーが1Passwordで認証後、再度コミット実行で成功

---

## 学んだこと

### SearXNG設定について
- `limiter: false`: SearXNGへのリクエスト制限を無効化。ローカル利用では問題ないが、外部検索エンジンへの負荷軽減はPython側で実装が必要
- `formats: [html, json]`: htmlはWebUIでの手動確認用、jsonはAPI用。開発中は両方有効にしておくと便利
- `*_url: false`: プライバシーポリシー等のフッターリンクを非表示（ローカル専用のため不要）

### Docker環境について
- `OLLAMA_FLASH_ATTENTION=1`: VRAM使用量を削減（6GB制限に重要）
- `OLLAMA_KEEP_ALIVE=24h`: モデルを24時間VRAMに常駐させ、再ロード時間を削減

---

## 次回への引き継ぎ
- [ ] Phase 2: Pythonプロジェクト構造の構築
  - pyproject.toml作成
  - src/, tests/ ディレクトリ構造
  - 開発ツール設定 (pytest, mypy, ruff)
- [ ] 検索ツール実装時にリクエスト間隔（1〜2秒）を設けること

---

## 参考リンク
- [SearXNG Documentation](https://docs.searxng.org/admin/settings/settings)
- [Ollama Docker Image](https://hub.docker.com/r/ollama/ollama)

---

## コミット
- `029798e` Docker環境セットアップ (Phase 1.1)
